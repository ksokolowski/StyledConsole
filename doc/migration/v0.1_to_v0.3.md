# Migration Guide: v0.1.0 â†’ v0.3.0

**Last Updated:** October 21, 2025

## Summary

v0.3.0 integrates Rich's native renderables for ANSI-safe rendering while maintaining **100% backward compatibility**. All v0.1.0 code continues to work unchanged. This guide shows recommended patterns for new code and how to gradually modernize existing code.

## What Changed

### Core Architecture

- **Console.frame()** now uses Rich Panel internally (eliminates ANSI wrapping bugs)
- **box_mapping.py** maps border styles to Rich box types
- **LayoutComposer** imports Rich primitives (Group, Columns, Table, Align)
- **Legacy utilities** preserved: FrameRenderer, effects.py, BannerRenderer

### Benefits

âœ… **ANSI-safe rendering** - No more double-wrapping bugs
âœ… **Better alignment** - Rich handles padding correctly
âœ… **Cleaner code** - Direct Rich composition available
âœ… **Backward compatible** - Existing code still works

## Migration Patterns

### 1. Simple Frames

#### Old Pattern (v0.1.0, still works)
```python
from styledconsole.core.frame import FrameRenderer

renderer = FrameRenderer()
for line in renderer.render(
    content="Hello, World!",
    title="Greeting",
    border="rounded",
    border_color="blue"
):
    print(line)
```

#### âœ¨ Recommended (v0.3.0)
```python
from styledconsole import Console

console = Console()
console.frame(
    content="Hello, World!",
    title="Greeting",
    border="rounded",
    border_color="blue"
)
```

**Why migrate:** Simpler API, ANSI-safe, better alignment handling.

---

### 2. Vertical Stacking

#### Old Pattern (v0.1.0, still works)
```python
from styledconsole.core.layout import LayoutComposer
from styledconsole.core.frame import FrameRenderer

renderer = FrameRenderer()
composer = LayoutComposer()

frame1 = renderer.render("First block", border="solid")
frame2 = renderer.render("Second block", border="solid")
frame3 = renderer.render("Third block", border="solid")

layout = composer.stack([frame1, frame2, frame3], spacing=1)
for line in layout:
    print(line)
```

#### âœ¨ Recommended (v0.3.0)
```python
from rich.console import Group
from rich.panel import Panel
from rich.text import Text
from styledconsole import Console
from styledconsole.core.box_mapping import get_box_style

console = Console()

# Create panels
panel1 = Panel("First block", box=get_box_style("solid"))
panel2 = Panel("Second block", box=get_box_style("solid"))
panel3 = Panel("Third block", box=get_box_style("solid"))

# Stack with spacing
group = Group(panel1, Text(""), panel2, Text(""), panel3)
console._rich_console.print(group)
```

**Why migrate:** More flexible, direct Rich composition, ANSI-safe.

---

### 3. Side-by-Side Layout

#### Old Pattern (v0.1.0, still works)
```python
from styledconsole.core.layout import LayoutComposer
from styledconsole.core.frame import FrameRenderer

renderer = FrameRenderer()
composer = LayoutComposer()

left = renderer.render("Left column\nMore content", border="rounded")
right = renderer.render("Right column\nMore content", border="rounded")

layout = composer.side_by_side(left, right, spacing=3)
for line in layout:
    print(line)
```

#### âœ¨ Recommended (v0.3.0)
```python
from rich.columns import Columns
from rich.panel import Panel
from styledconsole import Console
from styledconsole.core.box_mapping import get_box_style

console = Console()

left = Panel("Left column\nMore content", box=get_box_style("rounded"))
right = Panel("Right column\nMore content", box=get_box_style("rounded"))

columns = Columns([left, right], padding=(0, 2))
console._rich_console.print(columns)
```

**Why migrate:** Better width handling, ANSI-safe, more options (equal width, expand, etc.).

---

### 4. Grid Layout (2x2, 3x3, etc.)

#### Old Pattern (v0.1.0, still works)
```python
from styledconsole.core.layout import LayoutComposer
from styledconsole.core.frame import FrameRenderer

renderer = FrameRenderer()
composer = LayoutComposer()

# Create 2x2 grid
cells = [
    [renderer.render("Cell 1", border="solid"), renderer.render("Cell 2", border="solid")],
    [renderer.render("Cell 3", border="solid"), renderer.render("Cell 4", border="solid")]
]

layout = composer.grid(cells, spacing=2)
for line in layout:
    print(line)
```

#### âœ¨ Recommended (v0.3.0)
```python
from rich.panel import Panel
from rich.table import Table
from styledconsole import Console
from styledconsole.core.box_mapping import get_box_style

console = Console()

# Create panels
panel1 = Panel("Cell 1", box=get_box_style("solid"))
panel2 = Panel("Cell 2", box=get_box_style("solid"))
panel3 = Panel("Cell 3", box=get_box_style("solid"))
panel4 = Panel("Cell 4", box=get_box_style("solid"))

# Create grid with Table.grid
grid = Table.grid(padding=(0, 2))
grid.add_row(panel1, panel2)
grid.add_row(panel3, panel4)

console._rich_console.print(grid)
```

**Why migrate:** More flexible grid options, better alignment, ANSI-safe.

---

### 5. Alignment

#### Old Pattern (v0.1.0, still works)
```python
from styledconsole.core.layout import LayoutComposer
from styledconsole.core.frame import FrameRenderer

renderer = FrameRenderer()
composer = LayoutComposer()

frame = renderer.render("Centered content", border="rounded")
layout = composer.stack([frame], align="center")
for line in layout:
    print(line)
```

#### âœ¨ Recommended (v0.3.0)
```python
from rich.align import Align
from rich.panel import Panel
from styledconsole import Console
from styledconsole.core.box_mapping import get_box_style

console = Console()

panel = Panel("Centered content", box=get_box_style("rounded"))
aligned = Align(panel, align="center")
console._rich_console.print(aligned)
```

**Why migrate:** ANSI-safe alignment, handles emoji widths correctly.

---

### 6. Advanced Composition

#### âœ¨ New in v0.3.0: Direct Rich Panel Access

For advanced use cases, you can create Rich Panels directly and compose them:

```python
from rich.align import Align
from rich.console import Group
from rich.panel import Panel
from rich.text import Text
from styledconsole import Console
from styledconsole.core.box_mapping import get_box_style

console = Console()

# Create styled content
header_text = Text("Dashboard", style="bold cyan")
header = Panel(header_text, box=get_box_style("double"))

# Create status cards
status1 = Panel("ðŸš€ Performance\n\n95% uptime", box=get_box_style("rounded"), border_style="green")
status2 = Panel("ðŸ’¾ Storage\n\n512 GB free", box=get_box_style("rounded"), border_style="blue")
status3 = Panel("ðŸ“Š Users\n\n1,234 online", box=get_box_style("rounded"), border_style="yellow")

# Compose
dashboard = Group(
    header,
    Text(""),
    status1,
    Text(""),
    status2,
    Text(""),
    status3
)

# Center and print
console._rich_console.print(Align(dashboard, align="center"))
```

This gives you full access to Rich's powerful composition system while maintaining StyledConsole's border styles.

---

## Gradual Migration Strategy

You don't need to migrate all at once! Here's a recommended approach:

### Phase 1: Keep Using v0.1.0 Patterns
Your existing code works unchanged. No rush to migrate.

### Phase 2: New Code Uses v0.3.0 Patterns
- Use `Console.frame()` for new frames
- Use Rich Group/Columns/Table for new layouts
- Keep old code as-is

### Phase 3: Migrate High-Impact Code
- Migrate code that has ANSI wrapping bugs
- Migrate complex layouts that are hard to maintain
- Leave simple working code alone

### Phase 4: Full Migration (Optional)
- Replace FrameRenderer with Console.frame()
- Replace LayoutComposer with Rich primitives
- Only if you want cleaner code

## Breaking Changes

**None.** v0.3.0 is 100% backward compatible.

## New Features

### box_mapping.py

Map StyledConsole border styles to Rich box types:

```python
from styledconsole.core.box_mapping import get_box_style

box = get_box_style("solid")    # Returns rich.box.SQUARE
box = get_box_style("rounded")  # Returns rich.box.ROUNDED
box = get_box_style("double")   # Returns rich.box.DOUBLE
# ... all 8 styles supported
```

### Direct Rich Access

Access the underlying Rich console for advanced features:

```python
from styledconsole import Console

console = Console()

# Access Rich console directly
console._rich_console.print("[bold red]Rich markup![/bold red]")
console._rich_console.print(rich_renderable)
```

## Testing

All 654 tests passing in v0.3.0 (95.96% coverage). No regressions from v0.1.0.

## Examples

See `examples/basic/` for updated examples:

- `05_console_frames.py` - Console.frame() usage (recommended)
- `07_rich_layouts.py` - Rich Group/Columns/Table examples
- `09_emoji_validation.py` - Simplified emoji validation demo
- `examples/gallery/border_gallery.py` - All 8 border styles with Console.frame()
- `examples/showcase/rainbow_fat_alignment.py` - Complex alignment with Rich Panel

Old examples archived as `*_old.py` for reference.

## Questions?

- See `doc/project/PLAN.md` for v0.3.0 architecture details
- See `examples/` for working code examples
- All public APIs documented with type hints

---

**Migration Status:** Optional - v0.1.0 code continues to work
**Recommended For:** New code, bug fixes, cleaner architecture
**Not Required For:** Existing working code
